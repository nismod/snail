from igraph import Graph
import geopandas as gpd
import matplotlib.pyplot as plt

gdf = gpd.read_file("jamaica_roads.gpkg")
edges = gdf.loc[:, ["from_node", "to_node", "length_km"]]

g = Graph.DataFrame(edges, directed=False)

start = g.vs.find(name="roadn_0")
finish = g.vs.find(name="roadn_15891")

# Return list of list of edge IDs
# Return vpath for comparison with pandana
sp = g.get_shortest_paths(
    start.index, finish.index, weights="length_km", output="vpath"
)

# base = gdf.plot()
# for path in sp:
#     # Select linestrings according to edge IDs making the path
#     # edge ID are 1to1 with row id in dataframe
#     sub_gdf = gdf.iloc[path, :]
#     sub_gdf.plot(ax=base, color="green")
# plt.show()

nodes_gdf = gpd.read_file("jamaica_roads.gpkg", layer="nodes")
base = gdf.plot()
for path in sp:
    nodeslist = [int(g.vs[i]["name"][6:]) for i in path]
    # Select linestrings according to edge IDs making the path
    # edge ID are 1to1 with row id in dataframe
    sub_gdf = nodes_gdf.iloc[nodeslist, :]
    sub_gdf.plot(ax=base, color="red", markersize=6)
plt.show()

# edge list
# [[0, 11345, 11356, 15399, 15357, 15356, 526, 1, 521, 522, 524, 523, 520, 509, 510, 519, 517, 516, 518, 515, 513, 512, 511, 506, 3244, 3245, 3260, 3261, 3255, 3256, 3254, 3253, 3250, 3247, 3249, 3251, 3258, 3259, 3777, 3781, 3785, 3784, 3786, 3766, 3765, 3778, 3805, 3804, 542, 539, 540, 685, 684, 683, 682, 680, 688, 687, 686, 679, 678, 689, 690, 694, 706, 700, 699, 698, 697, 696, 695, 705, 704, 715, 693, 691, 716, 717, 718, 720, 719, 711, 708, 709, 710, 713, 701, 702, 707, 712, 976, 989, 988, 990, 978, 977, 983, 982, 996, 995, 993, 986, 987, 992, 994, 984, 985, 979, 8043, 7988, 981, 997, 15476, 15472, 7944, 15473, 4475, 4476, 4470, 4471, 4472, 4481, 4479, 4473, 4474, 4477, 4478, 7833, 15495, 15510, 15509, 15531, 4573, 4572, 4578, 4579, 4581, 4577, 4576, 4575, 4574, 4571, 4570, 785, 809, 1387, 1390, 1382, 1383, 1397, 1395, 1394, 1398, 1378, 1379, 1396, 1388, 1389, 1399, 1391, 1384, 1385, 1380, 1377, 1376, 1393, 1386, 1369, 4614, 4608, 4607, 4606, 4610, 4609, 4597, 4596, 4598, 4599, 4615, 4595, 4594, 4600, 4601, 4603, 4604, 4605, 1310, 1311, 1334, 4988, 8099, 4925, 4915, 4914, 4917, 4916, 4919, 4918, 4920, 4926, 4937, 4932, 4933, 4938, 4939, 4934, 4936, 7611, 4940, 5028, 5029, 7722, 5041, 5044, 5043, 5039, 5040, 5042, 1139, 1154, 1153, 1149, 1150, 1151, 1146, 1147, 8332, 1155, 5345, 5342, 5341, 5387, 5388, 5389, 5484, 5470, 5471, 5486, 5398, 5397, 8199, 5391, 5396, 5394, 5395, 5399, 5393, 5392, 5400, 5427, 5420, 5415, 5403, 5404, 8266, 5428, 5411, 5413, 5406, 5405, 5407, 5429, 5430, 5408, 5409, 5414, 5416, 5417, 5426, 5424, 5425, 5431, 8299, 5402, 1182, 1179, 1173, 1174, 1178, 1180, 1184, 1168, 1167, 1166, 1165, 16002, 16003, 16004, 16009, 15979, 15978, 15980, 15992, 15987, 15986, 15985, 15996, 15995, 15993, 15984, 15983, 15982, 15974, 15973, 15991, 15990, 8310, 15989, 15998, 15997, 6294, 6292, 6293, 6120, 6208, 6305, 6304, 6302, 6298, 8243, 6297, 6296, 6295, 6303, 6554, 6551, 6552, 6558, 6555, 6550, 6543, 6544, 6548, 6549, 6539, 6540, 6546, 6547]]

# vertex list
# [0, 538, 539, 9029, 8992, 8991, 10470, 1, 10466, 10467, 10469, 10468, 10465, 10455, 10456, 10464, 10462, 10461, 10463, 10460, 10459, 10458, 10457, 10452, 12918, 12919, 12932, 12933, 12928, 12929, 12927, 12926, 12923, 12920, 12922, 12924, 12930, 12931, 13398, 13400, 13404, 13403, 13405, 13388, 13387, 13399, 13422, 13421, 10485, 10482, 10483, 10613, 10612, 10611, 10610, 10609, 10616, 10615, 10614, 10608, 10607, 10617, 10618, 10621, 10632, 10627, 10626, 10625, 10624, 10623, 10622, 10631, 10630, 10640, 10620, 10619, 10641, 10642, 10643, 10645, 10644, 10637, 10634, 10635, 10636, 10639, 10628, 10629, 10633, 10638, 10876, 10888, 10887, 10889, 10878, 10877, 10882, 10881, 10894, 10893, 10891, 10885, 10886, 10890, 10892, 10883, 10884, 10879, 24, 235, 10880, 10895, 9099, 9095, 231, 9096, 14025, 14026, 14020, 14021, 14022, 14030, 14029, 14023, 14024, 14027, 14028, 221, 9115, 9129, 9128, 9148, 14113, 14112, 14118, 14119, 14120, 14117, 14116, 14115, 14114, 14111, 14110, 10703, 10725, 11245, 11248, 11240, 11241, 11254, 11252, 11251, 11255, 11237, 11238, 11253, 11246, 11247, 11256, 11249, 11242, 11243, 11239, 11236, 11235, 11250, 11244, 11229, 14150, 14145, 14144, 14143, 14147, 14146, 14135, 14134, 14136, 14137, 14151, 14133, 14132, 14138, 14139, 14140, 14141, 14142, 11176, 11177, 11198, 14488, 245, 14430, 14421, 14420, 14423, 14422, 14425, 14424, 14426, 14431, 14441, 14437, 14438, 14442, 14443, 14439, 14440, 201, 14444, 14523, 14524, 211, 14535, 14538, 14537, 14533, 14534, 14536, 11021, 11035, 11034, 11030, 11031, 11032, 11028, 11029, 266, 11036, 14809, 14806, 14805, 14847, 14848, 14849, 14934, 14921, 14922, 14936, 14857, 14856, 254, 14850, 14855, 14853, 14854, 14858, 14852, 14851, 14859, 14883, 14877, 14872, 14861, 14862, 260, 14884, 14869, 14870, 14864, 14863, 14865, 14885, 14886, 14866, 14867, 14871, 14873, 14874, 14882, 14880, 14881, 14887, 263, 14860, 11060, 11058, 11052, 11053, 11057, 11059, 11062, 11048, 11047, 11046, 11045, 9572, 9573, 9574, 9579, 9551, 9550, 9552, 9563, 9559, 9558, 9557, 9567, 9566, 9564, 9556, 9555, 9554, 9547, 9546, 9562, 9561, 264, 9560, 9569, 9568, 15663, 15661, 15662, 15506, 15586, 15673, 15672, 15670, 15667, 258, 15666, 15665, 15664, 15671, 15898, 15895, 15896, 15900, 15899, 15894, 15888, 15889, 15892, 15893, 15884, 15885, 15890, 15891]
